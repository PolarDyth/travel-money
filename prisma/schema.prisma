// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model Customer {
  id                   Int      @id @default(autoincrement())
  firstNameEnc         String
  lastNameEnc          String
  postcodeEnc          String
  addressLine1Enc      String
  cityEnc              String
  countryEnc           String
  emailEnc             String?
  phoneEnc             String?

  // Primary ID
  primaryIdTypeEnc       String?
  primaryIdNumberEnc     String?
  primaryIdIssueDateEnc  String?
  primaryIdExpiryDateEnc String?
  customerDOBEnc         String?

  // Secondary ID
  secondaryIdTypeEnc        String?
  secondaryIdNumberEnc      String?
  secondaryIdIssueDateEnc   String?
  secondaryIdExpiryDateEnc  String?

  // Relations
  transactions           Transaction[]

  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
}

model Transaction {
  id                Int      @id @default(autoincrement())
  transactionType   String
  transactionDate   DateTime @default(now())
  operatorId        Int

  // Relations
  customerId        Int
  customer          Customer @relation(fields: [customerId], references: [id])

  // Currency details (one-to-many)
  currencyDetails   CurrencyDetail[]

  // Verification
  paymentMethod           String   // Store as JSON string
  cashTendered            Decimal? @db.Decimal(10, 2)

  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

model CurrencyDetail {
  id              Int      @id @default(autoincrement())
  transaction     Transaction @relation(fields: [transactionId], references: [id])
  transactionId   Int

  currencyCode    String
  sterlingAmount  Decimal  @db.Decimal(10, 2)
  foreignAmount   Decimal  @db.Decimal(10, 2)
  exchangeRate    Decimal  @db.Decimal(10, 6)
  transactionType String

  operatorId      Int?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}